<?xml version="1.0" encoding="windows-1252" ?>
<!--Ant buildfile generated by Oracle JDeveloper-->
<project name="AWRParser" default="all">
  <property file="build.properties"/>
  <property name="build.root.dir" value="."/>
  <property name="visual-awr.version.old" value="v02e" /> 
  <property name="visual-awr.version.num" value="v02f" />

  <path id="classpath.build">
    <pathelement location="${build.root.dir}/lib/jcommon-1.0.22.jar"/>
    <pathelement location="./lib/jfreechart-1.0.17.jar"/>
    <pathelement location="./lib/jcommon-xml-1.0.22.jar"/>
    <pathelement location="./lib/ojdbc5.jar"/>
    <pathelement location="./lib/commons-compress-1.8.1.jar"/>
  </path>
  
  <!-- ALL -->
  <target name="all" description="Clean, Build, and Obfuscate">
  	<antcall target="clean"/>
  	<antcall target="build"/>
  	<antcall target="dist"/>
  </target>
	
  <!-- TARGET CLEAN -->
  <target name="clean" description="Clean the project">
    <delete includeemptydirs="true" quiet="true">
      <fileset dir="./classes" includes="**/*"/>
    </delete>
  </target>
  
  <target name="version" description="Replaces the version# in code and readme">
    <replace file="./src/org/altaprise/vawr/ui/RootFrame.java" token="${visual-awr.version.old}" value="${visual-awr.version.num}"/>
    <replace file="./vawr-readme.html" token="${visual-awr.version.old}" value="${visual-awr.version.num}"/>
  </target>
  
  <target name="build" description="Compile Java source files" depends="version">
    <mkdir dir="./classes"/>
    <javac srcdir="./src" destdir="./classes"
           classpathref="classpath.build" includes="*/**/*.java" deprecation="on"
           failonerror="true" debug="${debug}"/>
  </target>
  
  <target name="jar" description="Build the Jar file(s)">
   <delete file="./lib/vawr.jar"/>
   <delete file="./lib/vawr-utils.jar"/>
    <jar jarfile="./lib/vawr.jar"
         basedir="./classes" 
         excludes="/org/altaprise/vawr/utils/**/*" 
    />
    <jar jarfile="./lib/vawr-utils.jar"
         basedir="./classes"
         includes="/org/altaprise/vawr/utils/**/*"
    />
  </target>
  
  <target name="dist" description="create the distribution" depends="jar">
    <delete includeemptydirs="true" dir="./dist"/>
    <mkdir dir="./dist"/>
    <mkdir dir="./dist/lib"/>
    <mkdir dir="./dist/testing"/>
    
    <copy todir="./dist/lib">
      <fileset dir="./lib">
        <include name="jfreechart*.jar"/>
        <include name="jcommon*.jar"/>
        <include name="commons-compress*.jar"/>
        <include name="ojdbc*.jar"/>
        <include name="vawr.jar"/>
        <include name="vawr-utils.jar"/>
        <include name="*.gif"/>
      </fileset>
    </copy>

    <!-- Obfiscate 
    <antcall target="obfuscate"/>
    -->
    <delete file="./dist/lib/vawr.jar"/>
    
    <copy todir="./dist">
      <fileset dir=".">
        <include name="vawr-readme.html"/>
        <include name="run.bat"/>
        <include name="run.sh"/>
        <include name="properties.ser"/>
      </fileset>
    </copy>
    
    <!--Copy Test Files -->
    <copy todir="./dist/testing">
      <fileset dir="./testing">
        <include name="**/AWRMiner/**/*EDWPRD*.out"/>
        <include name="**/AWRMiner/**/*XXXX*.out"/>
      </fileset>
      <fileset dir="./testing">
        <include name="**/IOStat-Linux/**/*.dat"/>
      </fileset>
      <fileset dir="./testing">
        <include name="**/TopStat-Linux/**/*.dat"/>
      </fileset>
      <fileset dir="./testing">
        <include name="**/TopStat-SunOS/**/*.dat"/>
      </fileset>
    </copy>

    <zip destfile="./dist/visual-awr-${visual-awr.version.num}.zip"
         basedir="./dist/" excludes="jdk/**, *.zip"/>

  </target>
  
  <!-- TARGET OBFUSCATE -->
  <target name="obfuscate" description="Obfuscate the code">
  <taskdef resource="proguard/ant/task.properties"
           classpath="./lib/proguard.jar" />
  
  <proguard>

    <!-- Specify the input jars, output jars, and library jars. -->

    -injars './dist/lib/vawr.jar'
    -outjars './dist/lib/vawr-o.jar'
    
    -libraryjars 'D:\oracle\Java\jre7\lib\rt.jar'
    -libraryjars '.\dist\lib\jcommon-1.0.22.jar'
    -libraryjars '.\dist\lib\jfreechart-1.0.17.jar'
    -libraryjars '.\dist\lib\commons-compress-1.8.1.jar'
    -libraryjars '.\dist\lib\ojdbc5.jar'
    -libraryjars '.\dist\lib\vawr-utils.jar'
    
    -dontshrink


    <!-- Keep - Applications. Keep all application classes, along with their 'main' -->
    <!-- methods.                                                                   -->
    -keepclasseswithmembers public class * {
        public static void main(java.lang.String[]);
    }
    
    -keepclassmembers class * implements java.io.Serializable {
            static final long serialVersionUID;
            static final java.io.ObjectStreamField[] serialPersistentFields;
            private void writeObject(java.io.ObjectOutputStream);
            private void readObject(java.io.ObjectInputStream);
            java.lang.Object writeReplace();
            java.lang.Object readResolve();
    }
    
    <!-- Also keep - Enumerations. Keep the special static methods that are required in -->
    <!-- enumeration classes.                                                           -->
    -keepclassmembers enum  * {
        public static **[] values();
        public static ** valueOf(java.lang.String);
    }
    
    <!-- Also keep - Database drivers. Keep all implementations of java.sql.Driver. -->
    -keep class * extends java.sql.Driver
    
    <!-- Also keep - Swing UI L&F. Keep all extensions of javax.swing.plaf.ComponentUI, -->
    <!-- along with the special 'createUI' method.                                      -->
    -keep class * extends javax.swing.plaf.ComponentUI {
        public static javax.swing.plaf.ComponentUI createUI(javax.swing.JComponent);
    }
    
    <!-- Keep names - Native method names. Keep all native class/method names.  
    -keepclasseswithmembers,allowshrinking class * {
        native <methods>;
    }
    -->
    
  </proguard>
  
</target>

</project>
